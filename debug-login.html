<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Firebase Auth Debug</title>
  <style>
    body{font:14px/1.4 system-ui;margin:0;padding:16px;background:#f7fafc}
    .card{background:#fff;border:1px solid #e2e8f0;border-radius:12px;padding:16px;max-width:600px;margin:auto}
    input,button{padding:8px;border:1px solid #e2e8f0;border-radius:8px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    #log{white-space:pre-wrap;background:#0f172a;color:#e2e8f0;padding:10px;border-radius:8px;height:220px;overflow:auto}
  </style>
</head>
<body>
<div class="card">
  <h2>Firebase Auth Debug</h2>
  <div><strong>Authorized domain</strong>: <span id="domain"></span></div>
  <div id="sdk" style="margin:4px 0;"></div>
  <div class="row" style="margin-top:8px">
    <input id="email" type="email" placeholder="jouwnaam@dorcas.nl">
    <input id="password" type="password" placeholder="••••••••">
  </div>
  <div style="display:flex;gap:8px;margin-top:8px">
    <button id="login">Log in</button>
    <button id="signup">Sign up</button>
    <button id="logout">Log uit</button>
  </div>
  <div id="user" style="margin-top:8px;color:#334155"></div>
  <h3>Log</h3>
  <div id="log"></div>
</div>

<script type="module">
  const domainEl = document.getElementById('domain');
  const sdkEl = document.getElementById('sdk');
  const logEl = document.getElementById('log');
  const userEl = document.getElementById('user');
  const log = (...args)=>{
    const msg = args.map(a=>typeof a==='object'?JSON.stringify(a,null,2):String(a)).join(' ');
    console.log(...args);
    logEl.textContent += '\\n' + msg;
    logEl.scrollTop = logEl.scrollHeight;
  };
  window.addEventListener('error', e=> log('window.onerror:', e.message));
  window.addEventListener('unhandledrejection', e=> log('unhandledrejection:', e.reason?.message || e.reason || e));

  domainEl.textContent = location.hostname;

  try{
    // Import SDKs
    const { initializeApp } = await import("https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js");
    const { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } =
      await import("https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js");

    sdkEl.textContent = "Firebase SDK geladen ✅";
    const firebaseConfig = {
      apiKey: "AIzaSyAh8NlJEsAimk5XetB46b4hVmT83ZbHc4o",
      authDomain: "dorcas-travel-planner.firebaseapp.com",
      projectId: "dorcas-travel-planner",
      messagingSenderId: "964093814653",
      appId: "1:964093814653:web:5f5a542f9593f82cfe0e14"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    onAuthStateChanged(auth, (u)=>{
      userEl.textContent = u ? `Ingelogd als: ${u.email}` : "Niet ingelogd";
      log('onAuthStateChanged:', u ? u.email : 'null');
    });

    document.getElementById('login').onclick = async ()=>{
      const email = document.getElementById('email').value;
      const pass = document.getElementById('password').value;
      try{
        const cred = await signInWithEmailAndPassword(auth, email, pass);
        log('login ok:', cred.user.email);
      }catch(e){ log('login error:', e.code, e.message); alert(e.code + ' — ' + e.message); }
    };
    document.getElementById('signup').onclick = async ()=>{
      const email = document.getElementById('email').value;
      const pass = document.getElementById('password').value;
      try{
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        log('signup ok:', cred.user.email);
      }catch(e){ log('signup error:', e.code, e.message); alert(e.code + ' — ' + e.message); }
    };
    document.getElementById('logout').onclick = async ()=>{
      await signOut(auth); log('logout ok');
    };
  }catch(e){
    sdkEl.textContent = "Firebase SDK laden faalde ❌";
    log('SDK import error:', e.message);
  }
</script>
</body>
</html>
